<html lang="en">
<head>
  <style type="text/css">
  span { border:black 1px solid; }
  </style>
  <script type="text/javascript" src="ajax.js"></script>
  <script type="text/javascript">
  doAjaxPost("const.txt", "targetID", fnApplyToInnerHTML);
  function getRandomColor() {
      var sHex = '0123456789ABCDEF';
      var color = '#';
      // we don't want a black backgroud so 4 is as low as we go
      color += sHex.charAt(Math.floor(Math.random() * 12)+4);
      color += sHex.charAt(Math.floor(Math.random() * 12)+4); 
      color += sHex.charAt(Math.floor(Math.random() * 12)+4);
      color += sHex.charAt(Math.floor(Math.random() * 12)+4);
      color += sHex.charAt(Math.floor(Math.random() * 12)+4);
      color += sHex.charAt(Math.floor(Math.random() * 12)+4);
      return color;
  }
  function MyApply(fSuccess, responseText, targetId) {
      var e = document.getElementById(targetId);
      if (e) {
          if (fSuccess) {
              e.bgColor = getRandomColor();
              e.innerHTML = responseText;
          } else {
              e.bgColor = '#FF0000';
              e.innerHTML = "E";
              stopAjaxTest();
          }
      }
  }
  var fStop = false;
  function spawnAjaxTest() {
      document.getElementById("ajaxItemsInUse").innerHTML = cAjaxRequestsInUse;
      document.getElementById("ajaxCacheSize").innerHTML = ajaxRequestCache.length;
      if (fStop) {
          return;
      }
      var id1 = 'td' + Math.floor(Math.random()*100);
      doAjaxPost('inc.php?n=' + document.getElementById(id1).innerHTML, id1, MyApply);
      var fSpawned = false;
      if (Math.floor(Math.random()*100) > 38 + cAjaxRequestsInUse) {
          setTimeout(spawnAjaxTest, Math.floor(Math.random()*5000));
          fSpawned = true;
      }
      if (Math.floor(Math.random()*100) > 38 + cAjaxRequestsInUse) {
          setTimeout(spawnAjaxTest, Math.floor(Math.random()*5000));
          fSpawned = true;
      }
      if (!fSpawned) { // so we never stop
          setTimeout(spawnAjaxTest, Math.floor(Math.random()*5000));
      }
  }
  function stopAjaxTest() {
      fStop = true;
      ajaxRequestCache = [];
  }
  </script>
</head>
<body>
<div id="targetID"></div>
Increment Number:<input type="text" value="14" id="incNum"/><button onclick="doAjaxPost('inc.php?n=' + document.getElementById('incNum').value, 'incNum', fnApplyToValue);">Increment Now</button>
<br><button onclick="fStop=false; spawnAjaxTest();">Go!</button>
<button onclick="stopAjaxTest();">Stop!</button>
Ajax Object Count:<span id="ajaxItemsInUse"></span>
Ajax Object Cache Size:<span id="ajaxCacheSize"></span>
<div>
  <table>
    <tr>
      <td id="td0">0</td>
      <td id="td1">0</td>
      <td id="td2">0</td>
      <td id="td3">0</td>
      <td id="td4">0</td>
      <td id="td5">0</td>
      <td id="td6">0</td>
      <td id="td7">0</td>
      <td id="td8">0</td>
      <td id="td9">0</td>
    </tr>
    <tr>
      <td id="td10">0</td>
      <td id="td11">0</td>
      <td id="td12">0</td>
      <td id="td13">0</td>
      <td id="td14">0</td>
      <td id="td15">0</td>
      <td id="td16">0</td>
      <td id="td17">0</td>
      <td id="td18">0</td>
      <td id="td19">0</td>
    </tr>
    <tr>
      <td id="td20">0</td>
      <td id="td21">0</td>
      <td id="td22">0</td>
      <td id="td23">0</td>
      <td id="td24">0</td>
      <td id="td25">0</td>
      <td id="td26">0</td>
      <td id="td27">0</td>
      <td id="td28">0</td>
      <td id="td29">0</td>
    </tr>
    <tr>
      <td id="td30">0</td>
      <td id="td31">0</td>
      <td id="td32">0</td>
      <td id="td33">0</td>
      <td id="td34">0</td>
      <td id="td35">0</td>
      <td id="td36">0</td>
      <td id="td37">0</td>
      <td id="td38">0</td>
      <td id="td39">0</td>
    </tr>
    <tr>
      <td id="td40">0</td>
      <td id="td41">0</td>
      <td id="td42">0</td>
      <td id="td43">0</td>
      <td id="td44">0</td>
      <td id="td45">0</td>
      <td id="td46">0</td>
      <td id="td47">0</td>
      <td id="td48">0</td>
      <td id="td49">0</td>
    </tr>
    <tr>
      <td id="td50">0</td>
      <td id="td51">0</td>
      <td id="td52">0</td>
      <td id="td53">0</td>
      <td id="td54">0</td>
      <td id="td55">0</td>
      <td id="td56">0</td>
      <td id="td57">0</td>
      <td id="td58">0</td>
      <td id="td59">0</td>
    </tr>       
    <tr>
      <td id="td60">0</td>
      <td id="td61">0</td>
      <td id="td62">0</td>
      <td id="td63">0</td>
      <td id="td64">0</td>
      <td id="td65">0</td>
      <td id="td66">0</td>
      <td id="td67">0</td>
      <td id="td68">0</td>
      <td id="td69">0</td>
    </tr>
    <tr>
      <td id="td70">0</td>
      <td id="td71">0</td>
      <td id="td72">0</td>
      <td id="td73">0</td>
      <td id="td74">0</td>
      <td id="td75">0</td>
      <td id="td76">0</td>
      <td id="td77">0</td>
      <td id="td78">0</td>
      <td id="td79">0</td>
    </tr>
    <tr>
      <td id="td80">0</td>
      <td id="td81">0</td>
      <td id="td82">0</td>
      <td id="td83">0</td>
      <td id="td84">0</td>
      <td id="td85">0</td>
      <td id="td86">0</td>
      <td id="td87">0</td>
      <td id="td88">0</td>
      <td id="td89">0</td>
    </tr>
    <tr>
      <td id="td90">0</td>
      <td id="td91">0</td>
      <td id="td92">0</td>
      <td id="td93">0</td>
      <td id="td94">0</td>
      <td id="td95">0</td>
      <td id="td96">0</td>
      <td id="td97">0</td>
      <td id="td98">0</td>
      <td id="td99">0</td>
    </tr>
  </table>
</div>
</body>
</html>
      
      
      
